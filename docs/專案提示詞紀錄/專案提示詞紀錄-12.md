## Gemini æå• è³‡æ–™è¡¨å¤šé‡ä¸Šå‚³-ç‹€æ…‹æ¢ä¿®æ•´
ğŸ”§ ç›®å‰ç‹€æ…‹ï¼š
æˆ‘å°‡ä½ æä¾›çš„ä»£ç¢¼åŠ åˆ°æˆ‘çš„å°ˆæ¡ˆä¸­ï¼Œã€Œå¤šå€‹è³‡æ–™è¡¨åŒæ™‚ä¸Šå‚³ã€åŠŸèƒ½å¯¦ç¾çš„å¾ˆå¥½ï¼Œå³å´é‚Šæ¬„çš„ç‹€æ…‹æ¢ä¹Ÿå¾ˆæ£’ã€‚

â“æ¥ä¸‹ä¾†æƒ³è™•ç†çš„å•é¡Œï¼š
- `FileUploadStatus` ä¸æ‡‰è©²ç”¨æª”åä½œç‚º IDï¼Œå¦‚æœä½¿ç”¨è€…ä¸Šå‚³åŒåæª”æ¡ˆï¼Œæœƒç™¼ç”Ÿè¦†è“‹ï¼Œæ‡‰è©²åŠ å…¥æ™‚é–“æˆ³æˆ–è€…éš¨æ©Ÿæ•¸
- ç‹€æ…‹æ¢æ°¸ä¹…åœç•™ï¼Œæˆ‘å¸Œæœ›æˆåŠŸçš„ç‹€æ…‹æ¢åªåœç•™ 10 ç§’ï¼Œå¤±æ•—çš„ç‹€æ…‹æ¢åœç•™ 30 ç§’ã€‚
- çµ¦å·²ç¶“ä¸Šå‚³çµæŸçš„ç‹€æ…‹æ¢(ç„¡è«–æˆåŠŸæˆ–å¤±æ•—)åŠ ä¸Šå‰å‰æŒ‰éˆ•ï¼Œå¯ä»¥ç›´æ¥åˆªé™¤è©²ç‹€æ…‹æ¢ã€‚

## Gemini å›ç­” è³‡æ–™è¡¨å¤šé‡ä¸Šå‚³-ç‹€æ…‹æ¢ä¿®æ•´
å¥½çš„ï¼Œé€™äº›éƒ½æ˜¯éå¸¸åˆç†çš„å„ªåŒ–ã€‚æˆ‘å€‘å°‡é‡å°é€™ä¸‰å€‹å•é¡Œï¼Œå° `src/stores/uploadStore.ts` ä»¥åŠç›¸é—œçš„ UI å…ƒä»¶é€²è¡Œä¿®æ”¹ã€‚

-----

### 1\. è§£æ±ºåŒåæª”æ¡ˆè¦†è“‹å•é¡Œ

æ‚¨çš„è§€å¯Ÿéå¸¸æ­£ç¢ºï¼Œå–®ç´”ä½¿ç”¨æª”åä½œç‚º ID åœ¨è™•ç†åŒåæª”æ¡ˆæ™‚æœƒå‡ºå•é¡Œã€‚æˆ‘å€‘å¯ä»¥ç‚ºæ¯å€‹ä¸Šå‚³ä»»å‹™ç”Ÿæˆä¸€å€‹å”¯ä¸€çš„ ID ä¾†è§£æ±ºé€™å€‹å•é¡Œã€‚ä½¿ç”¨ `Date.now()` å’Œä¸€å€‹éš¨æ©Ÿæ•¸çš„çµ„åˆæ˜¯ä¸€å€‹ç°¡å–®ä¸”æœ‰æ•ˆçš„æ–¹æ³•ã€‚

#### `src/stores/uploadStore.ts` ä¿®æ”¹

```typescript
// src/stores/uploadStore.ts
import { create } from "zustand";
import { devtools } from "zustand/middleware";
import { parseDataFile } from "../utils";
import { DataTableInfo } from "shared/types/dataTable";

export interface FileUploadStatus {
  id: string; // ä½¿ç”¨éš¨æ©Ÿæ•¸ä½œç‚ºå”¯ä¸€ ID
  fileName: string;
  status: "uploading" | "success" | "failed";
  progress?: number;
  error?: string;
  info?: DataTableInfo;
  timeoutId?: ReturnType<typeof setTimeout>; // ç”¨æ–¼å„²å­˜å®šæ™‚å™¨ ID
}

interface UploadState {
  uploads: FileUploadStatus[];
  addUpload: (file: File) => string; // å›å‚³æ–°å»ºç«‹çš„ ID
  updateUploadStatus: (
    id: string,
    status: FileUploadStatus["status"],
    info?: DataTableInfo,
    error?: string
  ) => void;
  // è™•ç†ä¸Šå‚³æª”æ¡ˆçš„éåŒæ­¥é‚è¼¯
  startUploads: (files: File[]) => Promise<void>;
  reset: () => void;
  removeUpload: (id: string) => void; // æ–°å¢ç§»é™¤æ–¹æ³•
}

export const useUploadStore = create<UploadState>()(
  devtools(
    (set, get) => ({
      uploads: [],

      addUpload: (file: File) => {
        const newId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        set((state) => ({
          uploads: [
            ...state.uploads,
            { id: newId, fileName: file.name, status: "uploading" },
          ],
        }));
        return newId;
      },

      updateUploadStatus: (id, status, info, error) => {
        set((state) => ({
          uploads: state.uploads.map((upload) =>
            upload.id === id ? { ...upload, status, info, error } : upload
          ),
        }));
      },

      removeUpload: (id) => {
        set((state) => ({
          uploads: state.uploads.filter((upload) => upload.id !== id),
        }));
      },

      startUploads: async (files: File[]) => {
        const { updateUploadStatus, addUpload, removeUpload } = get();

        for (const file of files) {
          const newId = addUpload(file);
          try {
            const parsedData = await parseDataFile(file);
            const tableInfo = { name: file.name.split(".")[0], description: "" };
            const dataTableInfo = await window.api.uploadTable(
              tableInfo,
              parsedData
            );
            updateUploadStatus(newId, "success", dataTableInfo);
            // æˆåŠŸå¾Œè¨­å®šå®šæ™‚å™¨
            setTimeout(() => {
              removeUpload(newId);
            }, 10000); // 10 ç§’å¾Œè‡ªå‹•ç§»é™¤
          } catch (e: unknown) {
            console.error(`ä¸Šå‚³ ${file.name} å¤±æ•—:`, e);
            const errorMsg = e instanceof Error ? e.message : "æœªçŸ¥éŒ¯èª¤";
            updateUploadStatus(newId, "failed", undefined, errorMsg);
            // å¤±æ•—å¾Œè¨­å®šå®šæ™‚å™¨
            setTimeout(() => {
              removeUpload(newId);
            }, 30000); // 30 ç§’å¾Œè‡ªå‹•ç§»é™¤
          }
        }
      },
      
      reset: () => {
        set({ uploads: [] });
      },
    }),
    { name: "upload-store" }
  )
);
```

### 2\. ç‹€æ…‹æ¢è‡ªå‹•ç§»é™¤èˆ‡æ‰‹å‹•åˆªé™¤æŒ‰éˆ•

ç‚ºäº†å¯¦ç¾è‡ªå‹•ç§»é™¤ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ `startUploads` æ–¹æ³•ä¸­ï¼Œç•¶æª”æ¡ˆä¸Šå‚³æˆåŠŸæˆ–å¤±æ•—å¾Œï¼Œä½¿ç”¨ `setTimeout` ä¾†è‡ªå‹•å‘¼å« `removeUpload` æ–¹æ³•ã€‚åŒæ™‚ï¼Œæˆ‘å€‘éœ€è¦çµ¦å·²å®Œæˆçš„ç‹€æ…‹æ¢åŠ ä¸Šæ‰‹å‹•ç§»é™¤çš„æŒ‰éˆ•ã€‚

#### `src/components/DataTablesPage/UploadStatusPanel.tsx` ä¿®æ”¹

```tsx
// src/components/DataTablesPage/UploadStatusPanel.tsx
import React from "react";
import {
  Box,
  Typography,
  List,
  ListItem,
  ListItemText,
  LinearProgress,
  Paper,
  IconButton,
} from "@mui/material";
import CheckCircleIcon from "@mui/icons-material/CheckCircle";
import ErrorIcon from "@mui/icons-material/Error";
import CloudUploadIcon from "@mui/icons-material/CloudUpload";
import CloseIcon from "@mui/icons-material/Close"; // å¼•å…¥å‰å‰åœ–ç¤º
import { useUploadStore, FileUploadStatus } from "../../stores/uploadStore";

const getIcon = (status: FileUploadStatus['status']) => {
  switch (status) {
    case 'success':
      return <CheckCircleIcon color="success" sx={{ mr: 1 }} />;
    case 'failed':
      return <ErrorIcon color="error" sx={{ mr: 1 }} />;
    case 'uploading':
    default:
      return <CloudUploadIcon color="primary" sx={{ mr: 1 }} />;
  }
};

export const UploadStatusPanel: React.FC = () => {
  const uploads = useUploadStore((state) => state.uploads);
  const removeUpload = useUploadStore((state) => state.removeUpload); // å–å¾—ç§»é™¤æ–¹æ³•

  if (uploads.length === 0) {
    return (
      <Box sx={{ p: 2 }}>
        <Typography variant="h6">ç·¨è¼¯æ§åˆ¶é¢æ¿</Typography>
        <Typography variant="body2" sx={{ mt: 1 }}>
          é€™è£¡å¯ä»¥æ·»åŠ æ¬„ä½é¡å‹ã€ç¯©é¸ã€æ’åºç­‰æ§åˆ¶é …ã€‚
        </Typography>
      </Box>
    );
  }

  return (
    <Box sx={{ p: 2 }}>
      <Typography variant="h6">ä¸Šå‚³ç‹€æ…‹</Typography>
      <List dense sx={{ mt: 1 }}>
        {uploads.map((upload) => (
          <Paper key={upload.id} elevation={1} sx={{ mb: 1, p: 1 }}>
            <ListItem
              disablePadding
              secondaryAction={
                (upload.status === "success" || upload.status === "failed") && (
                  <IconButton
                    edge="end"
                    aria-label="delete"
                    onClick={() => removeUpload(upload.id)}
                    size="small"
                  >
                    <CloseIcon />
                  </IconButton>
                )
              }
            >
              {getIcon(upload.status)}
              <ListItemText
                primary={
                  <Typography variant="body2" sx={{ fontWeight: "bold" }}>
                    {upload.fileName}
                  </Typography>
                }
                secondary={
                  <Typography variant="body2" color="text.secondary">
                    {upload.status === "uploading"
                      ? "ä¸Šå‚³ä¸­..."
                      : upload.status === "success"
                      ? `ä¸Šå‚³æˆåŠŸ`
                      : `ä¸Šå‚³å¤±æ•—: ${upload.error}`}
                  </Typography>
                }
              />
            </ListItem>
            {upload.status === "uploading" && <LinearProgress />}
          </Paper>
        ))}
      </List>
    </Box>
  );
};
```

-----

### ç¸½çµ

1.  **å”¯ä¸€ ID**ï¼šæˆ‘å€‘åœ¨ `useUploadStore` çš„ `addUpload` æ–¹æ³•ä¸­ï¼Œç‚ºæ¯å€‹ä¸Šå‚³ä»»å‹™ç”Ÿæˆäº†ä¸€å€‹å”¯ä¸€çš„ IDï¼Œé€™å¾¹åº•è§£æ±ºäº†åŒåæª”æ¡ˆçš„è¦†è“‹å•é¡Œã€‚
2.  **è‡ªå‹•ç§»é™¤**ï¼šåœ¨ `startUploads` æ–¹æ³•ä¸­ï¼Œæˆ‘å€‘ç‚ºæˆåŠŸå’Œå¤±æ•—çš„ä»»å‹™åˆ†åˆ¥è¨­å®šäº† 10 ç§’å’Œ 30 ç§’çš„å®šæ™‚å™¨ï¼Œæ™‚é–“ä¸€åˆ°ï¼Œ`setTimeout` æœƒè§¸ç™¼ `removeUpload`ï¼Œè‡ªå‹•å¾åˆ—è¡¨ä¸­ç§»é™¤è©²ä»»å‹™ã€‚
3.  **æ‰‹å‹•ç§»é™¤**ï¼šåœ¨ `UploadStatusPanel` å…ƒä»¶ä¸­ï¼Œæˆ‘å€‘åˆ©ç”¨ MUI çš„ `ListItem` çš„ `secondaryAction` å±¬æ€§ï¼Œç‚ºå·²å®Œæˆï¼ˆæˆåŠŸæˆ–å¤±æ•—ï¼‰çš„ç‹€æ…‹æ¢æ·»åŠ äº†ä¸€å€‹å‰å‰æŒ‰éˆ•ï¼Œä½¿ç”¨è€…å¯ä»¥éš¨æ™‚æ‰‹å‹•ç§»é™¤å®ƒã€‚

é€™ä¸‰å€‹å„ªåŒ–ä½¿å¾—å¤šæª”æ¡ˆä¸Šå‚³åŠŸèƒ½æ›´åŠ å¥å£¯å’Œäººæ€§åŒ–ï¼Œæä¾›äº†æ›´å¥½çš„ä½¿ç”¨è€…é«”é©—ã€‚

## Gemini æå• 
## Gemini å›ç­” 
## Gemini æå• 
## Gemini å›ç­” 
## Gemini æå• 
## Gemini å›ç­” 
## Gemini æå• 
## Gemini å›ç­” 
## Gemini æå• 
## Gemini å›ç­” 